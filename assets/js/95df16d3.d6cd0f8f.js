"use strict";(self.webpackChunktestdoc=self.webpackChunktestdoc||[]).push([[8289],{28453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>l});var i=a(96540);const r={},s=i.createContext(r);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(s.Provider,{value:n},e.children)}},45895:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"big-data/Apache Iceberg/features/schema-evolution","title":"Schema Evolution","description":"Think of schema changes as product release, not just technical updates.","source":"@site/versioned_docs/version-1.0/big-data/Apache Iceberg/features/schema-evolution.md","sourceDirName":"big-data/Apache Iceberg/features","slug":"/big-data/Apache Iceberg/features/schema-evolution","permalink":"/Docs/docs/big-data/Apache Iceberg/features/schema-evolution","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/versioned_docs/version-1.0/big-data/Apache Iceberg/features/schema-evolution.md","tags":[],"version":"1.0","frontMatter":{},"sidebar":"bigdataSidebar","previous":{"title":"Apache Iceberg Features","permalink":"/Docs/docs/big-data/Apache Iceberg/features/"},"next":{"title":"Tools","permalink":"/Docs/docs/big-data/Apache Kafka/Tools"}}');var r=a(74848),s=a(28453);const t={},l="Schema Evolution",o={},d=[{value:"Add New Column",id:"add-new-column",level:2},{value:"Best Practices",id:"best-practices",level:3},{value:"Exmaple",id:"exmaple",level:3},{value:"Drop / Rename Column",id:"drop--rename-column",level:2},{value:"Drop Colum",id:"drop-colum",level:3},{value:"Rename Column",id:"rename-column",level:3},{value:"Best Practices",id:"best-practices-1",level:3},{value:"Reorder Columns",id:"reorder-columns",level:2},{value:"Change Column Type",id:"change-column-type",level:2},{value:"Explanation of Guidelines",id:"explanation-of-guidelines",level:3},{value:"Add/Modify Partition Fields (Optional)",id:"addmodify-partition-fields-optional",level:2},{value:"Key Takeaway",id:"key-takeaway",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"schema-evolution",children:"Schema Evolution"})}),"\n",(0,r.jsx)(n.admonition,{title:"Important",type:"danger",children:(0,r.jsx)(n.p,{children:"Think of schema changes as product release, not just technical updates."})}),"\n",(0,r.jsx)(n.h2,{id:"add-new-column",children:"Add New Column"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Backward- and forward-compatible"}),"\n",(0,r.jsx)(n.li,{children:"New field registered in metadata with default value (usually null)"}),"\n",(0,r.jsx)(n.li,{children:"Old readers simply ignore the extra column"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use clear, descriptive names"})," Ensure the column name conveys its purpose and unit (e.g., order_status_code rather than status)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Define sensible defaults"})," Set a default value or mark NOT NULL with a default to prevent unintended NULLs in new and existing rows."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audit downstream dependencies"})," Identify and update ETL jobs, views, BI reports, and API consumers before rolling out the change."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Communicate schema changes"})," Announce additions in your data catalog, schema registry, or team channels to keep everyone aligned."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Keep changes additive"})," Never repurpose or drop existing columns in the same change\u2014additive evolution minimizes breakages."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"exmaple",children:"Exmaple"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Add a New Column with Comment"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"ALTER TABLE spark_catalog.default.orders\r\n  ADD COLUMN new_column STRING\r\n    COMMENT 'Detailed description of new_column\u2019s purpose';\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Define a Default Value"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-SQL",children:"ALTER TABLE spark_catalog.default.orders\r\n  ALTER COLUMN new_column\r\n    SET DEFAULT 'default_value';\n"})}),"\n",(0,r.jsx)(n.h2,{id:"drop--rename-column",children:"Drop / Rename Column"}),"\n",(0,r.jsx)(n.p,{children:"Thaey are the common actions, you need to be caution"}),"\n",(0,r.jsx)(n.h3,{id:"drop-colum",children:"Drop Colum"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Allowed only if no downstream jobs or queries depend on it"}),"\n",(0,r.jsx)(n.li,{children:"Iceberg tracks dropped columns in history\u2014reads of old snapshots still work"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Safest practice:"})," deprecate first, then drop at next major version"]})}),"\n",(0,r.jsx)(n.h3,{id:"rename-column",children:"Rename Column"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Performed entirely in table metadata\u2014no data files rewritten"}),"\n",(0,r.jsx)(n.li,{children:"Downstream tools that hard-code column names may break"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"Best to coordinate with consumers or provide an alias"})}),"\n",(0,r.jsx)(n.h3,{id:"best-practices-1",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Renaming is safe but requires updating queries Changing a column\u2019s name only affects metadata; underlying data files aren\u2019t rewritten. Any SQL or BI reports that reference the old name must be updated to avoid errors."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Dropping columns is irreversible\u2014archive data first Once you issue a DROP COLUMN command, Iceberg marks the column as removed in metadata. The original values remain reachable in older table snapshots, but new reads won\u2019t include them. To prevent accidental data loss, export or back up that column\u2019s data before dropping."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Use schema versioning for rollback if needed Iceberg tracks each schema change in its versioned metadata. By referencing an earlier schema snapshot, you can roll back a problematic rename or drop. This practice ensures you can recover if downstream systems break after a change."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"reorder-columns",children:"Reorder Columns"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Purely logical change in metadata; physical file layout remains the same"}),"\n",(0,r.jsx)(n.li,{children:"Queries see fields in new order, but underlying storage is unaffected"}),"\n",(0,r.jsx)(n.li,{children:"Useful for cleaner schemas without heavy migration costs"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"change-column-type",children:"Change Column Type"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Narrowing conversions (e.g., INT \u2192 BIGINT) are usually safe"}),"\n",(0,r.jsx)(n.li,{children:"Widening or incompatible changes (e.g., STRING \u2192 INT) require data rewrite"}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsx)(n.p,{children:"Recommended approach:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add new column with desired type"}),"\n",(0,r.jsx)(n.li,{children:"Backfill data"}),"\n",(0,r.jsx)(n.li,{children:"Drop old column"}),"\n"]})]}),"\n",(0,r.jsx)(n.h3,{id:"explanation-of-guidelines",children:"Explanation of Guidelines"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Compatible changes are safe:\r\nChanging from a narrower type to a wider one (for example, INT to BIGINT or VARCHAR(50) to VARCHAR(100)) preserves all existing values without risk of overflow or truncation."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Incompatible changes can cause data loss:\r\nConverting from a wider type to a narrower one (for instance BIGINT to INT or VARCHAR(100) to VARCHAR(50)) may truncate data or fail when values exceed the target type\u2019s capacity."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Always test in a staging environment before production:\r\nValidating your type change on a non-production copy of the dataset helps catch failures or performance regressions before they affect live workloads."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Prefer adding a new column instead:\r\nIntroducing a new column with the desired type and backfilling values allows a gradual migration. Consumers can switch over when ready, avoiding a disruptive in-place change."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Consider data rewrites if needed:\r\nWhen neither a straight type change nor a new column is practical, you can perform a targeted ETL that transforms incompatible values into the new type with custom logic before swapping columns."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"addmodify-partition-fields-optional",children:"Add/Modify Partition Fields (Optional)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add new partition spec: Iceberg continues to use legacy spec for old data"}),"\n",(0,r.jsx)(n.li,{children:"Changing existing spec may require a table rewrite if partitions incompatible"}),"\n",(0,r.jsx)(n.li,{children:"Always test performance impact before rolling out"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"key-takeaway",children:"Key Takeaway"}),"\n",(0,r.jsx)(n.p,{children:"Apache Iceberg\u2019s versioned metadata and manifest design ensure that each of these schema changes can be tracked, audited, and, where possible, applied without full table rewrites\u2014keeping your data pipelines robust and flexible."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);