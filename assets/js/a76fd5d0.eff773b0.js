"use strict";(self.webpackChunktestdoc=self.webpackChunktestdoc||[]).push([[9686],{6222:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"security/kerberos/concepts","title":"Kerberos","description":"- It\'s a client/server based architecture","source":"@site/docs/security/kerberos/concepts.md","sourceDirName":"security/kerberos","slug":"/security/kerberos/concepts","permalink":"/Docs/docs/security/kerberos/concepts","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/security/kerberos/concepts.md","tags":[],"version":"current","frontMatter":{},"sidebar":"securitySidebar","previous":{"title":"encry-token","permalink":"/Docs/docs/security/encry-token"},"next":{"title":"LDAP","permalink":"/Docs/docs/security/ldap/concept"}}');var i=s(4848),l=s(8453);const c={},d="Kerberos",t={},a=[{value:"Principal parts",id:"principal-parts",level:2},{value:"Trust",id:"trust",level:2},{value:"Advantages",id:"advantages",level:2},{value:"Example: Access hdfs",id:"example-access-hdfs",level:2},{value:"Kerberos on Hadoop",id:"kerberos-on-hadoop",level:3},{value:"Installation",id:"installation",level:2},{value:"Server Side",id:"server-side",level:3},{value:"Client Side",id:"client-side",level:3},{value:"Useful links",id:"useful-links",level:3}];function o(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"kerberos",children:"Kerberos"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"It's a client/server based architecture"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"picture alt",src:s(6769).A+"",title:"kerberos",width:"1141",height:"622"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Principal"}),": an identity that needs to be verified"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"User Principal Names (UPN):"})," similar to usernames in operating systems."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service Principal Names (SPN):"})," is the service that the user needs to access (database, server, ...)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Realm"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A realm in Kerberos refers to an authentication administrative domain."}),"\n",(0,i.jsx)(n.li,{children:"Principals are assigned to specific realms in order to establish boundaries and simplify administration."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key Distribution Center (KDC)"}),": contains all information about principals and realm. It consists of:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Kerberos database:"})})," it stores","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"UPN and SPN"}),"\n",(0,i.jsx)(n.li,{children:"To which realm principal belongs to"}),"\n",(0,i.jsx)(n.li,{children:"Encryption keys"}),"\n",(0,i.jsx)(n.li,{children:"Tickets validation duration"}),"\n",(0,i.jsx)(n.li,{children:"Expiration date"}),"\n",(0,i.jsx)(n.li,{children:"..."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Authentication Server (AS):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Delivers TGT (Ticket Granting Ticket)"}),"\n",(0,i.jsx)(n.li,{children:"Authenticates users"}),"\n",(0,i.jsx)(n.li,{children:"TGT is delivered if authentication is successful"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Ticket Granting Server (TGS):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Validates ",(0,i.jsx)(n.strong,{children:"TGT"})]}),"\n",(0,i.jsx)(n.li,{children:"Delivers TS (Ticket Service)"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"KeyTab:"})," file that contains all keys related to specific service"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"principal-parts",children:"Principal parts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Primary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<shortname>@<REALM>"})}),"\n",(0,i.jsxs)(n.li,{children:["Example: ",(0,i.jsx)(n.code,{children:"bob@EXAMPLE.COM"})," => bob belongs to realm EXAMPLE.COM"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Instance"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<shortname>/<instance>@<REALM>"})}),"\n",(0,i.jsxs)(n.li,{children:["Example: ",(0,i.jsx)(n.code,{children:"username/admin@EXAMPLE.COM"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Service"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"<shortname>/<hostname>@<REALM>"})}),"\n",(0,i.jsxs)(n.li,{children:["Example: ",(0,i.jsx)(n.code,{children:"hdfs/node1.domain.com@EXAMPLE.COM"})," => service ",(0,i.jsx)(n.code,{children:"hdfs"})," in the node ",(0,i.jsx)(n.code,{children:"node1.domain.com"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"PS"}),": naming is ",(0,i.jsx)(n.strong,{children:"case-sensitive"})]}),"\n",(0,i.jsx)(n.h2,{id:"trust",children:"Trust"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"One way"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"bidirectional trust or full trust"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"advantages",children:"Advantages"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Is Single sign on"}),"\n",(0,i.jsx)(n.li,{children:"Password do not travel in clear over the network"}),"\n",(0,i.jsx)(n.li,{children:"A centralized repository for all users and services credentials"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example-access-hdfs",children:"Example: Access hdfs"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Authenticate using ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kinit"})})," service"]}),"\n",(0,i.jsx)(n.li,{children:"Sends authentication to Authentication Server"}),"\n",(0,i.jsxs)(n.li,{children:["If OK: AS sends TGT to user and ",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"kinit"})})," will store TGT in a credential cache and user is Authenticated"]}),"\n",(0,i.jsxs)(n.li,{children:["Now user wants to run command ",(0,i.jsx)(n.code,{children:"hdfs dfs -ls "}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Hadoop will use TGT and reach Ticket Granting Server"}),"\n",(0,i.jsx)(n.li,{children:"TGS will grant TS (Ticket Service) and client will cache TS"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Hadoop RPC will use TS to reach the Namenode"}),"\n",(0,i.jsx)(n.li,{children:"Client and Namenode exchange Tickets (Client ticket prove client identity and Namenode determines the identification of Namenode)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"kerberos-on-hadoop",children:"Kerberos on Hadoop"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create KDC"}),"\n",(0,i.jsx)(n.li,{children:"Create service principal for each service (HDFS, Yarn, ...)"}),"\n",(0,i.jsx)(n.li,{children:"Create Encrypted Kerberos Keys (Keytabs) for each service"}),"\n",(0,i.jsx)(n.li,{children:"Distribute keytab for service principals to each service on the cluster nodes"}),"\n",(0,i.jsx)(n.li,{children:"Configure all services (HDFS, Yarn, Hive, ...) to rely on Kerberos"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.h3,{id:"server-side",children:"Server Side"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"1. Install Kerberos Admin Server:"})," install the server and KDC"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"yum install krb5-workstation krb5-libs krb5-server"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Configure Kerberos"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Two configuration files"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/etc/krb5.conf"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/var/kerberos/krb5kdc/kdc.conf"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configure the realm"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"sudo vi /etc/krb5.conf"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[realms]\r\n # realm name\r\n HADOOP.COM = {  \r\n  # the name of KDC\r\n  kdc = server.hostname.com\r\n  # The admin Server\r\n  admin_server = server.hostname.com \r\n }\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Configure KDC"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"vi /var/kerberos/krb5kdc/kdc.conf"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"4. Create KDC database"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"    kdb5_util create -r HADOOP.COM -s\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"5. Specify the admin principals and add admin principal"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["All users in realm ",(0,i.jsx)(n.code,{children:"*/admin@HDPCLUSTER.COM"})," will have admin access"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"kadmin.local"})," utility used only on the krb server"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'vi /var/kerberos/krb5kdc/kadm5.acl\r\nkadmin.local -q "addprinc root/admin"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"6. Start kdc and the server"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"service krb5kdc start\r\nservice kadmin start\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"7. Test"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"# list if ticket is present in cache\r\nklist\r\n\r\n# get ticket\r\nkinit username\r\n\r\n# add principal\r\nkadmin\r\naddprinc username@REALM.COM\n"})}),"\n",(0,i.jsx)(n.h3,{id:"client-side",children:"Client Side"}),"\n",(0,i.jsxs)(n.p,{children:["1.",(0,i.jsx)(n.em,{children:(0,i.jsx)(n.strong,{children:"Install"})})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"yum install krb5-workstation krb5-libs krb5-auth-dialog"})}),"\n",(0,i.jsx)(n.h3,{id:"useful-links",children:"Useful links"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://examples.javacodegeeks.com/enterprise-java/apache-hadoop/hadoop-kerberos-authentication-tutorial",children:"https://examples.javacodegeeks.com/enterprise-java/apache-hadoop/hadoop-kerberos-authentication-tutorial"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.oreilly.com/library/view/hadoop-security/9781491900970/ch04.html",children:"https://www.oreilly.com/library/view/hadoop-security/9781491900970/ch04.html"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},6769:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/kerberos-45af1a253afb95a1d89668003bb9ba56.png"},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>d});var r=s(6540);const i={},l=r.createContext(i);function c(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);