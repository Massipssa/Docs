"use strict";(self.webpackChunktestdoc=self.webpackChunktestdoc||[]).push([[5770],{11439:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"programming/Python/testing","title":"Tests \u2014 BDD, TDD and Practical Testing Guide","description":"This document describes test types, workflows (BDD/TDD), tooling and practical examples for Python projects. It focuses on actionable guidelines, pytest examples, CI integration and strategies to keep tests fast, reliable and maintainable.","source":"@site/docs/programming/Python/testing.md","sourceDirName":"programming/Python","slug":"/programming/Python/testing","permalink":"/Docs/docs/next/programming/Python/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/programming/Python/testing.md","tags":[],"version":"current","frontMatter":{},"sidebar":"programmingSidebar","previous":{"title":"scraping","permalink":"/Docs/docs/next/programming/Python/scraping"},"next":{"title":"Architectural Design","permalink":"/Docs/docs/next/programming/architectural-design/"}}');var i=s(74848),r=s(28453);const l={},a="Tests \u2014 BDD, TDD and Practical Testing Guide",c={},o=[{value:"Principles &amp; workflows",id:"principles--workflows",level:2},{value:"Test types (the pyramid)",id:"test-types-the-pyramid",level:2},{value:"Test design guidelines",id:"test-design-guidelines",level:2},{value:"Python tooling overview",id:"python-tooling-overview",level:2},{value:"pytest basics &amp; examples",id:"pytest-basics--examples",level:2},{value:"Mocks, doubles and isolation",id:"mocks-doubles-and-isolation",level:2},{value:"Integration tests strategies",id:"integration-tests-strategies",level:2},{value:"Acceptance / BDD examples",id:"acceptance--bdd-examples",level:2},{value:"Property-based testing (Hypothesis)",id:"property-based-testing-hypothesis",level:2},{value:"Coverage &amp; quality gates",id:"coverage--quality-gates",level:2},{value:"CI integration tips",id:"ci-integration-tips",level:2},{value:"Flaky tests &amp; mitigation",id:"flaky-tests--mitigation",level:2},{value:"Test organisation &amp; naming",id:"test-organisation--naming",level:2},{value:"Example CI job snippet (GitHub Actions)",id:"example-ci-job-snippet-github-actions",level:2},{value:"Debugging failing tests",id:"debugging-failing-tests",level:2},{value:"Testing checklist (pre-PR)",id:"testing-checklist-pre-pr",level:2},{value:"Further reading &amp; tools",id:"further-reading--tools",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"tests--bdd-tdd-and-practical-testing-guide",children:"Tests \u2014 BDD, TDD and Practical Testing Guide"})}),"\n",(0,i.jsx)(n.p,{children:"This document describes test types, workflows (BDD/TDD), tooling and practical examples for Python projects. It focuses on actionable guidelines, pytest examples, CI integration and strategies to keep tests fast, reliable and maintainable."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"principles--workflows",children:"Principles & workflows"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Behavior Driven Development (BDD)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Structure: Given (context) \u2014 When (event) \u2014 Then (outcome)."}),"\n",(0,i.jsx)(n.li,{children:"Purpose: clarify behavior with examples; useful for acceptance tests and specifications."}),"\n",(0,i.jsx)(n.li,{children:"Use: feature files, plain-language scenarios, or tests written using the BDD style."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Test Driven Development (TDD)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cycle: Red (write failing test) \u2192 Green (make it pass) \u2192 Refactor (clean code)."}),"\n",(0,i.jsx)(n.li,{children:"Benefits: small incremental design, regression protection, better API design."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"test-types-the-pyramid",children:"Test types (the pyramid)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Unit tests (fast, isolated)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Test a single unit of code, no external I/O."}),"\n",(0,i.jsx)(n.li,{children:"Use mocks/stubs for external dependencies."}),"\n",(0,i.jsx)(n.li,{children:"Run frequently (pre-commit, local runs, PR checks)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Integration tests (slower, real integrations)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Verify interaction between components (DB, HTTP, filesystem)."}),"\n",(0,i.jsx)(n.li,{children:"Prefer lightweight/in-memory or containerized resources."}),"\n",(0,i.jsx)(n.li,{children:"Run in CI (separate job) or nightly."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"End-to-end / Functional / Acceptance tests (slowest)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Validate full system behavior from user/API perspective."}),"\n",(0,i.jsx)(n.li,{children:"Use real services or production-like environments."}),"\n",(0,i.jsx)(n.li,{children:"Run in staging or nightly pipelines."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Property-based testing (Hypothesis)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tests invariants across many inputs; useful for edge-cases."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"test-design-guidelines",children:"Test design guidelines"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Keep unit tests deterministic and fast (",(0,i.jsx)(n.code,{children:"<100ms"})," ideally)."]}),"\n",(0,i.jsx)(n.li,{children:"Test behavior, not implementation details."}),"\n",(0,i.jsxs)(n.li,{children:["Name tests clearly: ",(0,i.jsx)(n.code,{children:"test_<unit>__<scenario>__<expected>"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Use small fixtures; avoid large shared mutable state."}),"\n",(0,i.jsx)(n.li,{children:"Avoid flakiness: isolate external networks, control time, use retries cautiously."}),"\n",(0,i.jsx)(n.li,{children:"Prefer composition of small pure functions (easy to test)."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"python-tooling-overview",children:"Python tooling overview"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"pytest: modern test runner. Features: fixtures, parametrization, markers."}),"\n",(0,i.jsx)(n.li,{children:"unittest: Python stdlib runner; still useful for compatibility."}),"\n",(0,i.jsx)(n.li,{children:"coverage.py: measure test coverage (report and enforce thresholds)."}),"\n",(0,i.jsx)(n.li,{children:"Hypothesis: property-based testing."}),"\n",(0,i.jsx)(n.li,{children:"tox: run tests across interpreters/environments."}),"\n",(0,i.jsx)(n.li,{children:"pre-commit: run linters and quick checks before commit."}),"\n",(0,i.jsx)(n.li,{children:"Docker / Testcontainers: isolated integration tests."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"pytest-basics--examples",children:"pytest basics & examples"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run all tests:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pytest -q"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run a single test:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pytest -q tests/test_module.py::test_specific_case"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Run tests with marker:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"pytest -q -m integration"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Example ",(0,i.jsx)(n.code,{children:"conftest.py"})," (fixture scope and cleanup):"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="tests/conftest.py"',children:'\r\nimport pytest\r\nfrom pyspark.sql import SparkSession\r\n\r\n@pytest.fixture(scope="session")\r\ndef spark():\r\n    spark = SparkSession.builder.master("local[1]").appName("tests").getOrCreate()\r\n    yield spark\r\n    spark.stop()\r\n\r\n@pytest.fixture\r\ndef temp_dir(tmp_path):\r\n    return tmp_path / "data"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Example unit test:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="tests/test_utils.py"',children:'from mypkg.utils import normalize_email\r\n\r\ndef test_normalize_email_lowercases_and_strips():\r\n    assert normalize_email(" Alice@Example.COM ") == "alice@example.com"\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Parametrized test:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import pytest\r\n\r\n@pytest.mark.parametrize("input_,expected", [\r\n    ("A", "a"),\r\n    (" B ", "b"),\r\n])\r\ndef test_normalize_param(input_, expected):\r\n    assert normalize_email(input_) == expected\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"mocks-doubles-and-isolation",children:"Mocks, doubles and isolation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"unittest.mock"})," or ",(0,i.jsx)(n.code,{children:"pytest-mock"})," to replace external calls."]}),"\n",(0,i.jsx)(n.li,{children:"Mock at integration boundaries (HTTP, DB clients) not inside core logic."}),"\n",(0,i.jsx)(n.li,{children:"Example:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from unittest.mock import MagicMock\r\nclient = MagicMock()\r\nclient.get.return_value.json.return_value = {"id": 1}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"integration-tests-strategies",children:"Integration tests strategies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Lightweight approaches:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use in-memory DBs (SQLite) for schema-level tests."}),"\n",(0,i.jsx)(n.li,{children:"Use fixtures to spin up ephemeral services (docker-compose, testcontainers)."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"CI: run integration tests in separate job with longer timeout and service dependencies."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"acceptance--bdd-examples",children:"Acceptance / BDD examples"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use plain pytest with clear Given/When/Then comments or a BDD framework (behave, pytest-bdd)."}),"\n",(0,i.jsx)(n.li,{children:"Example style (pytest with comments):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def test_user_signup_flow(client, db):\r\n    # Given: a new user payload\r\n    payload = {"email": "u@example.com", "password": "pass"}\r\n    # When: posting to signup endpoint\r\n    resp = client.post("/signup", json=payload)\r\n    # Then: user exists and response is 201\r\n    assert resp.status_code == 201\r\n    assert db.users.find_one({"email": "u@example.com"}) is not None\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"property-based-testing-hypothesis",children:"Property-based testing (Hypothesis)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use Hypothesis for invariants and boundary cases:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from hypothesis import given, strategies as st\r\n\r\n@given(st.text(), st.integers(min_value=0, max_value=100))\r\ndef test_transform_invariant(s, n):\r\n    # assert invariants hold for many random inputs\r\n    result = my_transform(s, n)\r\n    assert isinstance(result, str)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"coverage--quality-gates",children:"Coverage & quality gates"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Measure coverage: ",(0,i.jsx)(n.code,{children:"pytest --cov=mypkg --cov-report=xml"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Enforce minimum coverage in CI (e.g., fail if < 80%)."}),"\n",(0,i.jsx)(n.li,{children:"Combine with linters (flake8, pylint), formatters (black), and static type checks (mypy)."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"ci-integration-tips",children:"CI integration tips"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Separate jobs:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"quick unit tests (fast)"}),"\n",(0,i.jsx)(n.li,{children:"integration tests (with services)"}),"\n",(0,i.jsx)(n.li,{children:"e2e/acceptance tests (staging)"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Cache virtualenvs and package layers to speed builds."}),"\n",(0,i.jsx)(n.li,{children:"Use service containers (Postgres, Kafka) in CI when needed."}),"\n",(0,i.jsx)(n.li,{children:"Inject secrets via CI secrets; avoid committing credentials."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"flaky-tests--mitigation",children:"Flaky tests & mitigation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Identify flaky tests and mark with a flaky marker."}),"\n",(0,i.jsx)(n.li,{children:"Use retries sparingly (pytest-rerunfailures) after investigating root cause."}),"\n",(0,i.jsx)(n.li,{children:"Common causes: timing, race conditions, reliance on external network, shared state."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"test-organisation--naming",children:"Test organisation & naming"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Directory layout:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"tests/unit/..."}),"\n",(0,i.jsx)(n.li,{children:"tests/integration/..."}),"\n",(0,i.jsx)(n.li,{children:"tests/e2e/..."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Test file naming: ",(0,i.jsx)(n.code,{children:"test_<module>.py"})]}),"\n",(0,i.jsxs)(n.li,{children:["Test function naming: ",(0,i.jsx)(n.code,{children:"test_<function>__<scenario>__<expected>"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"example-ci-job-snippet-github-actions",children:"Example CI job snippet (GitHub Actions)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# filepath: .github/workflows/ci.yml\r\nname: CI\r\non: [push, pull_request]\r\njobs:\r\n  unit-tests:\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      - uses: actions/checkout@v4\r\n      - name: Set up Python\r\n        uses: actions/setup-python@v4\r\n        with: python-version: "3.11"\r\n      - name: Install deps\r\n        run: |\r\n          python -m pip install --upgrade pip\r\n          pip install -r requirements-dev.txt\r\n      - name: Run tests\r\n        run: pytest -q\r\n      - name: Coverage\r\n        run: pytest --cov=mypkg --cov-report=xml\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"debugging-failing-tests",children:"Debugging failing tests"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Reproduce locally with same Python version and environment."}),"\n",(0,i.jsx)(n.li,{children:"Increase logging level to see details."}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"pytest -k <testname> -q -s"})," to run interactively."]}),"\n",(0,i.jsx)(n.li,{children:"Capture failing state artifacts (DB dump, logs, temp files) in CI artifacts."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-checklist-pre-pr",children:"Testing checklist (pre-PR)"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Unit tests added/updated for new logic."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Integration tests for new integrations."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tests are deterministic and pass locally."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Linting and type checks pass."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Coverage not decreased below threshold."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","No secrets in tests or fixtures."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"further-reading--tools",children:"Further reading & tools"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["pytest docs: ",(0,i.jsx)(n.a,{href:"https://docs.pytest.org/",children:"https://docs.pytest.org/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Hypothesis: ",(0,i.jsx)(n.a,{href:"https://hypothesis.readthedocs.io/",children:"https://hypothesis.readthedocs.io/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Testcontainers (for Python): ",(0,i.jsx)(n.a,{href:"https://github.com/testcontainers/testcontainers-python",children:"https://github.com/testcontainers/testcontainers-python"})]}),"\n",(0,i.jsx)(n.li,{children:"Martin Fowler on TDD/BDD and testing strategies."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"Keep tests fast and focused. Use TDD for small API design, BDD for specification/acceptance, and a layered approach (unit \u2192 integration \u2192 e2e) to achieve reliable, maintainable test suites."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var t=s(96540);const i={},r=t.createContext(i);function l(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);