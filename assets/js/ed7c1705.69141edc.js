"use strict";(self.webpackChunktestdoc=self.webpackChunktestdoc||[]).push([[2431],{18199:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"programming/Python/scope","title":"Python Scope & Name Resolution (LEGB)","description":"A compact, practical guide to how Python resolves names (the LEGB rule), common gotchas, and patterns to write clearer, less\u2011buggy code.","source":"@site/docs/programming/Python/scope.md","sourceDirName":"programming/Python","slug":"/programming/Python/scope","permalink":"/Docs/docs/next/programming/Python/scope","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/programming/Python/scope.md","tags":[],"version":"current","frontMatter":{},"sidebar":"programmingSidebar","previous":{"title":"Python Concepts","permalink":"/Docs/docs/next/programming/Python/concepts"},"next":{"title":"scraping","permalink":"/Docs/docs/next/programming/Python/scraping"}}');var i=s(74848),l=s(28453);const c={},o="Python Scope & Name Resolution (LEGB)",d={},a=[{value:"TL;DR \u2014 LEGB in one minute",id:"tldr--legb-in-one-minute",level:2},{value:"Quick Mental Model",id:"quick-mental-model",level:2},{value:"Minimal Examples",id:"minimal-examples",level:2},{value:"1) L, E, G, B in action",id:"1-l-e-g-b-in-action",level:3},{value:"2) <code>global</code> \u2014 rebind a module\u2011level name from inside a function",id:"2-global--rebind-a-modulelevel-name-from-inside-a-function",level:3},{value:"3) <code>nonlocal</code> \u2014 rebind a name in an enclosing (non\u2011global) scope",id:"3-nonlocal--rebind-a-name-in-an-enclosing-nonglobal-scope",level:3},{value:"4) Mutating vs. reassigning",id:"4-mutating-vs-reassigning",level:3},{value:"5) Comprehension &amp; generator scope (Python 3)",id:"5-comprehension--generator-scope-python-3",level:3},{value:"6) Class scope gotcha",id:"6-class-scope-gotcha",level:3},{value:"7) Closures &amp; loop\u2011variable capture (common pitfall)",id:"7-closures--loopvariable-capture-common-pitfall",level:3},{value:"8) Default\u2011argument evaluation time",id:"8-defaultargument-evaluation-time",level:3},{value:"9) <code>exec</code>, <code>import *</code>, and scope hygiene",id:"9-exec-import--and-scope-hygiene",level:3},{value:"Inspecting Runtime Scopes",id:"inspecting-runtime-scopes",level:2},{value:"Debugging Playbook",id:"debugging-playbook",level:2},{value:"Best Practices &amp; Patterns",id:"best-practices--patterns",level:2},{value:"Common Pitfalls \u2014 Checklist",id:"common-pitfalls--checklist",level:2},{value:"Glossary",id:"glossary",level:2},{value:"Further Reading",id:"further-reading",level:2},{value:"Try\u2011It Snippets (copy/paste)",id:"tryit-snippets-copypaste",level:3},{value:"Advanced Notes &amp; Edge Cases",id:"advanced-notes--edge-cases",level:2},{value:"What counts as a <em>binding</em>?",id:"what-counts-as-a-binding",level:3},{value:"<code>global</code> is per\u2011module",id:"global-is-permodule",level:3},{value:"Shadowing builtins (and how to escape it)",id:"shadowing-builtins-and-how-to-escape-it",level:3},{value:"Comprehensions &amp; <code>:=</code> (walrus) in Py3",id:"comprehensions---walrus-in-py3",level:3},{value:"<code>match</code> / <code>case</code> pattern variables",id:"match--case-pattern-variables",level:3},{value:"Classes are mappings, not enclosing scopes",id:"classes-are-mappings-not-enclosing-scopes",level:3},{value:"Introspection: freevars &amp; cellvars",id:"introspection-freevars--cellvars",level:3},{value:"Performance tidbits (micro)",id:"performance-tidbits-micro",level:3},{value:"Exercises (with expected outputs)",id:"exercises-with-expected-outputs",level:2},{value:"One\u2011Page Cheat Sheet",id:"onepage-cheat-sheet",level:2},{value:"FAQ",id:"faq",level:2}];function t(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"python-scope--name-resolution-legb",children:"Python Scope & Name Resolution (LEGB)"})}),"\n",(0,i.jsxs)(n.p,{children:["A compact, practical guide to how Python resolves names (the ",(0,i.jsx)(n.strong,{children:"LEGB"})," rule), common gotchas, and patterns to write clearer, less\u2011buggy code."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"tldr--legb-in-one-minute",children:"TL;DR \u2014 LEGB in one minute"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"L \u2014 Local"}),": Names created inside the current function or comprehension."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"E \u2014 Enclosing"}),": Names in any outer function scopes (for nested functions/closures)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"G \u2014 Global"}),": Names at module (file) level."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"B \u2014 Builtins"}),": Names available from the ",(0,i.jsx)(n.code,{children:"builtins"})," module (e.g., ",(0,i.jsx)(n.code,{children:"len"}),", ",(0,i.jsx)(n.code,{children:"print"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Resolution order:"})," Python searches ",(0,i.jsx)(n.strong,{children:"L \u2192 E \u2192 G \u2192 B"}),". The ",(0,i.jsx)(n.strong,{children:"first match wins"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Tip: A ",(0,i.jsx)(n.em,{children:"bare"})," name (no attribute/dot) follows LEGB. Attribute access (e.g., ",(0,i.jsx)(n.code,{children:"obj.x"}),") does not."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"quick-mental-model",children:"Quick Mental Model"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Local"})," = inside the current ",(0,i.jsx)(n.code,{children:"def"})," / ",(0,i.jsx)(n.code,{children:"lambda"})," (and, in Python 3, inside comprehension scopes)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enclosing"})," = surrounding ",(0,i.jsx)(n.code,{children:"def"}),"s (nearest outward) used by closures."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Global"})," = top\u2011level names in the current module."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Builtins"})," = final fallback from ",(0,i.jsx)(n.code,{children:"builtins"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"minimal-examples",children:"Minimal Examples"}),"\n",(0,i.jsx)(n.h3,{id:"1-l-e-g-b-in-action",children:"1) L, E, G, B in action"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'x = "global x"\r\n\r\ndef outer():\r\n    x = "enclosing x"\r\n    def inner():\r\n        x = "local x"\r\n        return x\r\n    return inner()\r\n\r\nprint(outer())  # local x\r\nprint(x)        # global x\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"inner"})," doesn\u2019t assign ",(0,i.jsx)(n.code,{children:"x"}),", it resolves to the enclosing value:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def outer():\r\n    x = "enclosing x"\r\n    def inner():\r\n        return x   # resolves to enclosing x\r\n    return inner()\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"2-global--rebind-a-modulelevel-name-from-inside-a-function",children:["2) ",(0,i.jsx)(n.code,{children:"global"})," \u2014 rebind a module\u2011level name from inside a function"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"count = 0\r\n\r\ndef bump():\r\n    global count\r\n    count += 1\r\n\r\nbump(); bump()\r\nprint(count)  # 2\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Without ",(0,i.jsx)(n.code,{children:"global"}),", ",(0,i.jsx)(n.code,{children:"count += 1"})," raises ",(0,i.jsx)(n.code,{children:"UnboundLocalError"})," because assignment marks ",(0,i.jsx)(n.code,{children:"count"})," as local."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"3-nonlocal--rebind-a-name-in-an-enclosing-nonglobal-scope",children:["3) ",(0,i.jsx)(n.code,{children:"nonlocal"})," \u2014 rebind a name in an enclosing (non\u2011global) scope"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def counter():\r\n    n = 0\r\n    def inc():\r\n        nonlocal n\r\n        n += 1\r\n        return n\r\n    return inc\r\n\r\nc = counter()\r\nprint(c(), c(), c())  # 1 2 3\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-mutating-vs-reassigning",children:"4) Mutating vs. reassigning"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"items = []\r\n\r\ndef add(a):\r\n    items.append(a)  # mutates the object bound to global `items`\r\n\r\ndef reset():\r\n    global items     # reassignment needs `global`\r\n    items = []\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5-comprehension--generator-scope-python-3",children:"5) Comprehension & generator scope (Python 3)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["List/set/dict comprehensions and generator expressions have their ",(0,i.jsx)(n.strong,{children:"own"})," scope in Python 3. The loop variable ",(0,i.jsx)(n.strong,{children:"does not leak"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'x = "global"\r\nvals = [x for x in range(3)]\r\nprint(x)    # "global"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"6-class-scope-gotcha",children:"6) Class scope gotcha"}),"\n",(0,i.jsxs)(n.p,{children:["A class body has a namespace during execution, but it is ",(0,i.jsx)(n.strong,{children:"not"})," an ",(0,i.jsx)(n.em,{children:"enclosing"})," scope for methods. Methods must access class attributes via ",(0,i.jsx)(n.code,{children:"self"})," or the class name."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'x = "module"\r\nclass C:\r\n    x = "class attr"\r\n    def f(self):\r\n        return C.x, self.x  # qualify explicitly\n'})}),"\n",(0,i.jsx)(n.h3,{id:"7-closures--loopvariable-capture-common-pitfall",children:"7) Closures & loop\u2011variable capture (common pitfall)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"funcs = [lambda: i for i in range(3)]\r\nprint([f() for f in funcs])  # [2, 2, 2] (all capture final i)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Fix by binding the current value as a default argument:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"funcs = [lambda i=i: i for i in range(3)]\r\nprint([f() for f in funcs])  # [0, 1, 2]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"8-defaultargument-evaluation-time",children:"8) Default\u2011argument evaluation time"}),"\n",(0,i.jsxs)(n.p,{children:["Default parameter values are evaluated ",(0,i.jsx)(n.strong,{children:"once"})," at function definition time (not at call time). Avoid mutable defaults:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def add(item, items=[]):   # \ud83d\udeab DONT\r\n    items.append(item)\r\n    return items\n"})}),"\n",(0,i.jsx)(n.p,{children:"Better:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def add(item, items=None):\r\n    items = [] if items is None else items\r\n    items.append(item)\r\n    return items\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"9-exec-import--and-scope-hygiene",children:["9) ",(0,i.jsx)(n.code,{children:"exec"}),", ",(0,i.jsx)(n.code,{children:"import *"}),", and scope hygiene"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exec()"})," and ",(0,i.jsx)(n.code,{children:"from module import *"})," can obscure where names come from and confuse linters/tools. Avoid in production."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"inspecting-runtime-scopes",children:"Inspecting Runtime Scopes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"locals()"})," \u2192 snapshot of local names."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"globals()"})," \u2192 module namespace."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"vars(obj)"})," \u2192 an object\u2019s attribute dict."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"import builtins"})," \u2192 inspect builtin names."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"inspect.getclosurevars(func)"})," \u2192 analyze captured names in a closure."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"debugging-playbook",children:"Debugging Playbook"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reproduce"})," the error (e.g., ",(0,i.jsx)(n.code,{children:"UnboundLocalError"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Probe"})," with ",(0,i.jsx)(n.code,{children:"print(locals())"})," or a debugger (",(0,i.jsx)(n.code,{children:"pdb"}),", ",(0,i.jsx)(n.code,{children:"breakpoint()"}),"), right before the failing line."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check assignments"}),": any assignment to a bare name makes it local unless declared ",(0,i.jsx)(n.code,{children:"global"}),"/",(0,i.jsx)(n.code,{children:"nonlocal"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Watch for captures"})," in comprehensions/loops\u2014use the default\u2011arg trick to freeze values."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lint"})," with ",(0,i.jsx)(n.code,{children:"ruff"}),"/",(0,i.jsx)(n.code,{children:"flake8"}),"; add ",(0,i.jsx)(n.code,{children:"mypy"})," for static checks."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"best-practices--patterns",children:"Best Practices & Patterns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Prefer ",(0,i.jsx)(n.strong,{children:"explicit parameters"})," over reading/writing globals."]}),"\n",(0,i.jsxs)(n.li,{children:["Keep functions ",(0,i.jsx)(n.strong,{children:"small and pure"}),"; return values instead of mutating outer state."]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"nonlocal"})," ",(0,i.jsx)(n.strong,{children:"sparingly"}),"; consider returning new state from inner functions instead."]}),"\n",(0,i.jsxs)(n.li,{children:["For closures inside loops, use the ",(0,i.jsx)(n.strong,{children:"default\u2011argument capture"})," pattern (",(0,i.jsx)(n.code,{children:"lambda i=i: ..."}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Avoid mutation of shared global state; if necessary, ",(0,i.jsx)(n.strong,{children:"encapsulate"})," in objects with clear APIs."]}),"\n",(0,i.jsxs)(n.li,{children:["Avoid ",(0,i.jsx)(n.code,{children:"from module import *"})," and ",(0,i.jsx)(n.code,{children:"exec()"}),"; prefer explicit imports and names."]}),"\n",(0,i.jsxs)(n.li,{children:["Don\u2019t shadow builtins (",(0,i.jsx)(n.code,{children:"list"}),", ",(0,i.jsx)(n.code,{children:"id"}),", ",(0,i.jsx)(n.code,{children:"str"}),", \u2026). If you must, alias: ",(0,i.jsx)(n.code,{children:"from typing import List as TList"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"common-pitfalls--checklist",children:"Common Pitfalls \u2014 Checklist"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,i.jsx)(n.code,{children:"UnboundLocalError"})," due to assignment before use."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Unexpected closure capture in loops/comprehensions."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Mutable default args causing shared state."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Assuming class body variables act as an enclosing scope for methods."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Name shadowing of builtins (",(0,i.jsx)(n.code,{children:"list"}),", ",(0,i.jsx)(n.code,{children:"id"}),", ",(0,i.jsx)(n.code,{children:"str"}),", etc.)."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"glossary",children:"Glossary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Binding"}),": associating a name with an object in a namespace."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Namespace"}),": a mapping from names to objects (e.g., module ",(0,i.jsx)(n.code,{children:"globals()"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Closure"}),": a function that captures variables from its enclosing scope."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Python docs \u2014 ",(0,i.jsx)(n.em,{children:"Naming and binding"}),": ",(0,i.jsx)(n.a,{href:"https://docs.python.org/3/reference/executionmodel.html#naming-and-binding",children:"https://docs.python.org/3/reference/executionmodel.html#naming-and-binding"})]}),"\n",(0,i.jsx)(n.li,{children:"Scoping of generator/comprehension variables \u2014 see PEP 289 history and Python 3 behavior."}),"\n",(0,i.jsxs)(n.li,{children:["Tools: ",(0,i.jsx)(n.code,{children:"inspect"}),", ",(0,i.jsx)(n.code,{children:"pdb"}),", ",(0,i.jsx)(n.code,{children:"ruff"}),"/",(0,i.jsx)(n.code,{children:"flake8"}),", ",(0,i.jsx)(n.code,{children:"mypy"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"tryit-snippets-copypaste",children:"Try\u2011It Snippets (copy/paste)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Probe locals"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def demo():\r\n    x = 1\r\n    print("locals:", locals())\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Freeze loop variable"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"funcs = []\r\nfor i in range(3):\r\n    funcs.append(lambda i=i: i)\r\nassert [f() for f in funcs] == [0, 1, 2]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Safe default pattern"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def append_safe(x, bucket=None):\r\n    bucket = [] if bucket is None else bucket\r\n    bucket.append(x)\r\n    return bucket\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"advanced-notes--edge-cases",children:"Advanced Notes & Edge Cases"}),"\n",(0,i.jsxs)(n.h3,{id:"what-counts-as-a-binding",children:["What counts as a ",(0,i.jsx)(n.em,{children:"binding"}),"?"]}),"\n",(0,i.jsxs)(n.p,{children:["The following statements ",(0,i.jsx)(n.strong,{children:"bind"})," names in the current local scope (unless marked otherwise):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assignment"})," (including tuple unpacking): ",(0,i.jsx)(n.code,{children:"x = 1"}),", ",(0,i.jsx)(n.code,{children:"a, b = b, a"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"augmented assignment"}),": ",(0,i.jsx)(n.code,{children:"x += 1"})," (also marks ",(0,i.jsx)(n.code,{children:"x"})," local unless ",(0,i.jsx)(n.code,{children:"global"}),"/",(0,i.jsx)(n.code,{children:"nonlocal"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"def"}),", ",(0,i.jsx)(n.code,{children:"class"}),": bind the function/class name in the surrounding scope"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"import"})," / ",(0,i.jsx)(n.code,{children:"from ... import ..."})," (bind imported names)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"except <Exc> as e"}),": binds ",(0,i.jsx)(n.code,{children:"e"})," ",(0,i.jsxs)(n.strong,{children:["in the ",(0,i.jsx)(n.code,{children:"except"})," block scope only"]})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"for"})," loop target in a function: binds in function local scope"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"with ... as x"}),": binds ",(0,i.jsx)(n.code,{children:"x"})," in the current block"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"match"})," / ",(0,i.jsx)(n.code,{children:"case"})," pattern variables: bind inside the ",(0,i.jsx)(n.code,{children:"case"})," block"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:":="})," ",(0,i.jsx)(n.em,{children:"walrus"})," operator: binds in the ",(0,i.jsx)(n.strong,{children:"nearest enclosing scope"})," where the expression appears (comprehensions have their own scope in Py3)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"del name"}),": unbinds (removes) a name from the current scope"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"global name"})," means assignments go to the ",(0,i.jsx)(n.strong,{children:"module"})," scope."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"nonlocal name"})," means assignments go to the ",(0,i.jsx)(n.strong,{children:"nearest enclosing function"})," scope; the name ",(0,i.jsx)(n.strong,{children:"must already exist"})," there."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"global-is-permodule",children:[(0,i.jsx)(n.code,{children:"global"})," is per\u2011module"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"global"})," refers to the current module\u2019s namespace\u2014not all modules."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# mod_a.py\r\nx = 0\r\n\r\ndef set_via_global():\r\n    global x\r\n    x = 99\r\n\r\n# mod_b.py\r\nimport mod_a\r\n\r\nmod_a.set_via_global()\r\nprint(mod_a.x)  # 99\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To write another module\u2019s global from ",(0,i.jsx)(n.em,{children:"here"}),", assign its attribute: ",(0,i.jsx)(n.code,{children:"mod_a.x = 5"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"shadowing-builtins-and-how-to-escape-it",children:"Shadowing builtins (and how to escape it)"}),"\n",(0,i.jsx)(n.p,{children:"A global or local can shadow a builtin:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"len = 42\r\nprint(len)      # 42\r\n# print(len([1,2]))  # TypeError\n"})}),"\n",(0,i.jsx)(n.p,{children:"Escape hatch:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import builtins\r\nprint(builtins.len([1,2]))  # 2\n"})}),"\n",(0,i.jsx)(n.p,{children:"Prefer not to shadow builtins; use different names."}),"\n",(0,i.jsxs)(n.h3,{id:"comprehensions---walrus-in-py3",children:["Comprehensions & ",(0,i.jsx)(n.code,{children:":="})," (walrus) in Py3"]}),"\n",(0,i.jsxs)(n.p,{children:["Comprehensions have their own scope; ",(0,i.jsx)(n.code,{children:":="})," binds ",(0,i.jsx)(n.strong,{children:"inside"})," that scope:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"x = 'module'\r\nvals = [y := x.upper() for x in 'ab']  # here, `x` is the loop var, local to comp\r\nprint('module x =', x)   # still 'module'\r\nprint(vals, y)           # ['A','B'] and NameError (y not bound outside)\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"match--case-pattern-variables",children:[(0,i.jsx)(n.code,{children:"match"})," / ",(0,i.jsx)(n.code,{children:"case"})," pattern variables"]}),"\n",(0,i.jsxs)(n.p,{children:["Pattern names bind ",(0,i.jsxs)(n.strong,{children:["within the ",(0,i.jsx)(n.code,{children:"case"})," block"]})," only:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def describe(t):\r\n    match t:\r\n        case (x, y):  # binds x,y here\r\n            return x + y\r\n    # x, y not defined here\n"})}),"\n",(0,i.jsx)(n.h3,{id:"classes-are-mappings-not-enclosing-scopes",children:"Classes are mappings, not enclosing scopes"}),"\n",(0,i.jsxs)(n.p,{children:["Inside a class body, ",(0,i.jsx)(n.em,{children:"simple"})," names refer to the class namespace while executing, but methods later look up via attribute access."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class C:\r\n    k = 10\r\n    lst = []\r\n    lst.append(1)   # ok: class body executes top\u2011to\u2011bottom\r\n    def f(self):\r\n        return self.k      # attribute lookup at runtime\n"})}),"\n",(0,i.jsx)(n.h3,{id:"introspection-freevars--cellvars",children:"Introspection: freevars & cellvars"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def make():\r\n    x = 1\r\n    def inner():\r\n        return x\r\n    return inner\r\n\r\nf = make()\r\nprint(f.__code__.co_freevars)  # ('x',)\n"})}),"\n",(0,i.jsx)(n.p,{children:"For deeper analysis:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import inspect\r\ninspect.getclosurevars(f)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"performance-tidbits-micro",children:"Performance tidbits (micro)"}),"\n",(0,i.jsx)(n.p,{children:"Local lookups are faster than globals/builtins. If you\u2019re in a hot loop:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from math import sqrt\r\ns = 0.0\r\nfor i in range(10_000):\r\n    s += sqrt(i)   # local name `sqrt` is a fast lookup\n"})}),"\n",(0,i.jsx)(n.p,{children:"Optimize only when profiling says so."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"exercises-with-expected-outputs",children:"Exercises (with expected outputs)"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"UnboundLocal"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"n = 10\r\n\r\ndef f():\r\n    n += 1\r\n    return n\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Q:"})," What error and why?"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"A:"})," ",(0,i.jsx)(n.code,{children:"UnboundLocalError"})," \u2014 assignment marks ",(0,i.jsx)(n.code,{children:"n"})," local, read happens before assignment."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Closure capture"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"funcs = [lambda: i for i in range(4)]\r\nprint([f() for f in funcs])\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Expected:"})," ",(0,i.jsx)(n.code,{children:"[3, 3, 3, 3]"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fix:"})," ",(0,i.jsx)(n.code,{children:"lambda i=i: i"})," \u2192 ",(0,i.jsx)(n.code,{children:"[0,1,2,3]"})]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Class scope"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"x = 'module'\r\nclass C:\r\n    x = 'class'\r\n    def show(self):\r\n        return x\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Q:"})," What does ",(0,i.jsx)(n.code,{children:"C().show()"})," return?"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"A:"})," ",(0,i.jsx)(n.code,{children:"'module'"})," \u2014 bare name resolves via LEGB in the method\u2019s scope; use ",(0,i.jsx)(n.code,{children:"self.x"})," or ",(0,i.jsx)(n.code,{children:"C.x"})," to access class attr."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Comprehension leakage"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"for i in range(3):\r\n    pass\r\nprint(i)\r\n\r\nj = 99\r\n[j for j in range(1)]\r\nprint(j)\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Expected (Py3):"})," first ",(0,i.jsx)(n.code,{children:"print(i)"})," \u2192 ",(0,i.jsx)(n.code,{children:"2"})," (loop binds in function/module scope).\r\nSecond ",(0,i.jsx)(n.code,{children:"print(j)"})," \u2192 ",(0,i.jsx)(n.code,{children:"99"})," (comprehension has its own scope; ",(0,i.jsx)(n.code,{children:"j"})," not overwritten)."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Walrus in conditions"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"if (m := 3) > 2:\r\n    pass\r\nprint(m)\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Expected:"})," ",(0,i.jsx)(n.code,{children:"3"})," \u2014 bound in the current scope (not a comprehension)."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"onepage-cheat-sheet",children:"One\u2011Page Cheat Sheet"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"LEGB:"})," Local \u2192 Enclosing \u2192 Global \u2192 Builtins"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Binders:"})," ",(0,i.jsx)(n.code,{children:"="}),", ",(0,i.jsx)(n.code,{children:"+="}),", ",(0,i.jsx)(n.code,{children:"def"}),", ",(0,i.jsx)(n.code,{children:"class"}),", ",(0,i.jsx)(n.code,{children:"import"}),", ",(0,i.jsx)(n.code,{children:"except ... as"}),", ",(0,i.jsx)(n.code,{children:"for"})," target, ",(0,i.jsx)(n.code,{children:"with ... as"}),", ",(0,i.jsx)(n.code,{children:"match"}),"/",(0,i.jsx)(n.code,{children:"case"})," names, ",(0,i.jsx)(n.code,{children:":="})," (scope\u2011aware), ",(0,i.jsx)(n.code,{children:"del"})," (unbinds)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Keywords:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"global x"})," \u2192 write to module scope"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"nonlocal x"})," \u2192 write to nearest enclosing function scope (must already exist)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Do:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pass values as params; avoid globals"}),"\n",(0,i.jsx)(n.li,{children:"Use default\u2011arg capture in closures inside loops"}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"None"})," sentinel for optional mutable params"]}),"\n",(0,i.jsx)(n.li,{children:"Lint (ruff/flake8) + type\u2011check (mypy)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don\u2019t:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Shadow builtins (",(0,i.jsx)(n.code,{children:"list"}),", ",(0,i.jsx)(n.code,{children:"id"}),", ",(0,i.jsx)(n.code,{children:"str"}),", ...)"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"from module import *"})," / ",(0,i.jsx)(n.code,{children:"exec"})," in production"]}),"\n",(0,i.jsx)(n.li,{children:"Rely on class body as enclosing scope for methods"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Introspect:"})," ",(0,i.jsx)(n.code,{children:"locals()"}),", ",(0,i.jsx)(n.code,{children:"globals()"}),", ",(0,i.jsx)(n.code,{children:"vars(obj)"}),", ",(0,i.jsx)(n.code,{children:"inspect.getclosurevars(f)"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Q:"})," Why does ",(0,i.jsx)(n.code,{children:"nonlocal"})," raise ",(0,i.jsx)(n.code,{children:"SyntaxError: no binding for nonlocal"}),"?\r\n",(0,i.jsx)(n.strong,{children:"A:"})," The name must already exist in a ",(0,i.jsx)(n.strong,{children:"non\u2011global"})," enclosing function scope."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Q:"})," Why does a comprehension not overwrite my outer loop variable?\r\n",(0,i.jsx)(n.strong,{children:"A:"})," In Python 3, comprehensions run in their own scope; the loop variable doesn\u2019t leak."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Q:"})," How can I modify a module\u2011level constant safely for tests?\r\n",(0,i.jsx)(n.strong,{children:"A:"})," Prefer dependency injection (pass it as a parameter) or patch the attribute explicitly in tests (",(0,i.jsx)(n.code,{children:"monkeypatch.setattr(mod, 'NAME', value)"}),")."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var r=s(96540);const i={},l=r.createContext(i);function c(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);