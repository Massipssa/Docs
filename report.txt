import org.apache.spark.sql.{DataFrame, SparkSession}
import org.apache.spark.sql.functions._
import org.apache.spark.sql.connector.expressions.Expressions

def writeIceberg(fullTableName: String, df: DataFrame, hasDay: Boolean): Unit = {
  if (hasDay) {
    val dfDaily =
      df.withColumn("event_date", make_date(col("year").cast("int"), col("month").cast("int"), col("day").cast("int")))

    dfDaily.writeTo(fullTableName)
      .partitionedBy(Expressions.days("event_date"))   // ✅ OK
      .createOrReplace()

  } else {
    val dfMonthly =
      df.withColumn("year", col("year").cast("int"))
        .withColumn("month", col("month").cast("int"))

    dfMonthly.writeTo(fullTableName)
      .partitionedBy(
        Expressions.identity("year"),                  // ✅ OK
        Expressions.identity("month")                  // ✅ OK
      )
      .createOrReplace()
  }
}
