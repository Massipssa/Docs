WITH parsed AS (
    SELECT
        vacation_name,
        regexp_replace(vacation_name, '.*_([0-9]{8})_.*', '\1')::date AS file_date,
        regexp_replace(vacation_name, '.*_([0-9]{1,2})\.tar\.bz2\.pgp', '\1')::int AS vacation_id,
        create_hour::time AS file_time
    FROM your_table
),
joined AS (
    SELECT
        p.*,
        v.start_time,
        CASE
            WHEN v.end_time < v.start_time
                THEN (v.end_time + interval '24 hours')  -- vacations crossing midnight
            ELSE v.end_time
        END AS real_end_time
    FROM parsed p
    JOIN vacations v ON v.vacation_id = p.vacation_id
)
SELECT
    vacation_name,
    vacation_id,
    file_date,
    file_time,
    start_time,
    real_end_time,
    CASE
        WHEN file_time > real_end_time THEN 'RETARD'
        ELSE 'OK'
    END AS status
FROM joined
ORDER BY file_date, vacation_id;
