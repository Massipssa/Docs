CREATE OR REPLACE VIEW v_vacation_7h AS
SELECT
    file_date,
    vacation_id,
    MIN(file_time) AS first_reception_time,
    (MIN(file_time) <= time '07:00') AS received_by_07h
FROM v_vacation_status
GROUP BY file_date, vacation_id;


SELECT *
FROM v_vacation_7h
WHERE received_by_07h = false;


CREATE OR REPLACE VIEW v_vacation_7h_summary AS
SELECT
    file_date,
    COUNT(*) AS total_vacations,
    COUNT(*) FILTER (WHERE received_by_07h)     AS vacations_received_by_07h,
    COUNT(*) FILTER (WHERE NOT received_by_07h) AS vacations_missing_at_07h
FROM v_vacation_7h
GROUP BY file_date;


SELECT *
FROM v_vacation_7h_summary
ORDER BY file_date DESC;
