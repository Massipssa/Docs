import React from "react";
import { Paper, Typography } from "@mui/material";
import { format, parse, isValid } from "date-fns";

// DynamicTable Component
const DynamicTable = ({ values }) => {
  const title = "CRE Integration";

  // Sample data from your API
  const data = [
    {
      objectName: "GLRAX",
      opcDate: "20240923",
      vacation: 1,
      status: "Ingested",
    },
    {
      objectName: "GLRAX",
      opcDate: "20240924",
      vacation: 2,
      status: "Ingested",
    },
    {
      objectName: "7X007",
      opcDate: "20240924",
      vacation: 3,
      status: "Ingested",
    },
    {
      objectName: "7X002",
      opcDate: "20240923",
      vacation: 4,
      status: "Ingested",
    },
    // Add more data as necessary...
  ];

  // Extract unique opcDate values to form the table columns
  const uniqueDates = [...new Set(data.map(item => item.opcDate))];

  // Create columns for each unique date
  const columns = [
    {
      accessorKey: 'objectName',
      header: 'CRE Name',
    },
    ...uniqueDates.map(date => ({
      accessorKey: date,
      header: isValid(parse(date, 'yyyyMMdd', new Date()))
        ? format(parse(date, 'yyyyMMdd', new Date()), 'dd/MM/yyyy')
        : date,  // Ensure the date is valid before formatting
      cell: ({ row }) => {
        const currentData = data.find(
          entry => entry.objectName === row.original.objectName && entry.opcDate === date
        );
        return (
          <Typography>
            {currentData ? `${currentData.vacation}:${currentData.opcDate}` : '-'}
          </Typography>
        );
      },
    })),
  ];

  // Prepare table data with CRE names and their corresponding vacation dates
  const tableData = [...new Map(data.map(item => [item.objectName, {
    objectName: item.objectName,
  }])).values()];

  return (
    <Paper>
      <Typography variant="h6">{title}</Typography>
      <ObjectTable
        columns={columns}
        data={tableData}
        pageSize={5}
        showActions={false}
      />
    </Paper>
  );
};

export default DynamicTable;
