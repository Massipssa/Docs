import React, { useState } from 'react';
import {
  Box,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  Collapse,
  Typography,
} from '@mui/material';
import { ExpandLess, ExpandMore } from '@mui/icons-material';
import GroupIcon from '@mui/icons-material/Group';
import SettingsIcon from '@mui/icons-material/Settings';
import BugReportIcon from '@mui/icons-material/BugReport';
import MergeTypeIcon from '@mui/icons-material/MergeType';
import TaskIcon from '@mui/icons-material/Task';

interface MenuItem {
  title: string;
  icon: React.ReactNode;
  count?: number;
  children?: MenuItem[];
}

const menuItems: MenuItem[] = [
  {
    title: 'Group',
    icon: <GroupIcon />,
    children: [
      { title: 'Pinned' },
      { title: 'Issues', count: 0 },
      { title: 'Merge requests', count: 3 },
      { title: 'Epics', count: 0 },
    ],
  },
  {
    title: 'Manage',
    icon: <TaskIcon />,
    children: [
      { title: 'Activity' },
      { title: 'Members' },
      { title: 'Labels' },
    ],
  },
  {
    title: 'Settings',
    icon: <SettingsIcon />,
    children: [],
  },
];

export default function SidebarMenu() {
  const [openItems, setOpenItems] = useState<string[]>([]);

  const handleToggle = (title: string) => {
    if (openItems.includes(title)) {
      setOpenItems(openItems.filter((item) => item !== title));
    } else {
      setOpenItems([...openItems, title]);
    }
  };

  const renderMenuItem = (item: MenuItem, level: number = 0) => {
    const hasChildren = item.children && item.children.length > 0;
    const isOpen = openItems.includes(item.title);

    return (
      <Box key={item.title}>
        <ListItem
          button
          onClick={() => hasChildren && handleToggle(item.title)}
          sx={{
            pl: level * 2, // Indentation for levels
            display: 'flex',
            alignItems: 'center',
          }}
        >
          <ListItemIcon>{item.icon}</ListItemIcon>
          <ListItemText
            primary={
              <Box display="flex" justifyContent="space-between" alignItems="center">
                <Typography>{item.title}</Typography>
                {item.count !== undefined && (
                  <Typography sx={{ ml: 2, fontSize: 12, color: '#757575' }}>
                    {item.count}
                  </Typography>
                )}
              </Box>
            }
          />
          {hasChildren &&
            (isOpen ? <ExpandLess /> : <ExpandMore />)}
        </ListItem>
        {hasChildren && (
          <Collapse in={isOpen} timeout="auto" unmountOnExit>
            <List disablePadding>
              {item.children!.map((child) => renderMenuItem(child, level + 1))}
            </List>
          </Collapse>
        )}
      </Box>
    );
  };

  return (
    <Box
      sx={{
        width: '240px',
        bgcolor: '#f5f5f5',
        height: '100vh',
        boxShadow: '2px 0 5px rgba(0,0,0,0.1)',
      }}
    >
      <List>
        {menuItems.map((item) => renderMenuItem(item))}
      </List>
    </Box>
  );
}
