import org.apache.spark.sql.DataFrameWriterV2

private def applyTableProperties[T](
  w: DataFrameWriterV2[T],
  props: Map[String, String]
): DataFrameWriterV2[T] =
  props.foldLeft[DataFrameWriterV2[T]](w) { case (acc, (k, v)) =>
    acc.tableProperty(k, v)
  }


import org.apache.spark.sql.DataFrameWriterV2

private def applyTableProperties(
  w: DataFrameWriterV2[_],
  props: Map[String, String]
): DataFrameWriterV2[_] = {
  val base: DataFrameWriterV2[_] = w   // âœ… widening
  props.foldLeft(base) { case (acc, (k, v)) =>
    acc.tableProperty(k, v)
  }
}

val writerWithProps = applyTableProperties(df.writeTo(fullTableName), tableProperties)
writerWithProps
  .partitionedBy(col("year"), col("month"))
  .createOrReplace()
