CREATE OR REPLACE VIEW v_no_vacation_before_7 AS
SELECT
    file_date,
    COUNT(*) FILTER (WHERE file_time <= time '07:00') AS nb_vacations_before_7,
    CASE
        WHEN COUNT(*) FILTER (WHERE file_time <= time '07:00') = 0
            THEN 1           -- aucune vacation avant 7h
        ELSE 0               -- au moins une vacation avant 7h
    END AS no_vacation_before_7
FROM v_vacation_status
GROUP BY file_date;


NoVacationToday =
VAR TodayDate = TODAY()
RETURN
CALCULATE (
    MAX ( 'v_no_vacation_before_7'[no_vacation_before_7] ),
    'v_no_vacation_before_7'[file_date] = TodayDate
)
